<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<meta name="GENERATOR" content="TtH 3.67">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>


<title> Reading Data from Web Pages</title>
 
<h1 align="center">Reading Data from Web Pages </h1>




<title> Examples of Reading Web Pages with R</title>
    
<h1 align="center">Examples of Reading Web Pages with R </h1>

<div class="p"><!----></div>
As an example of how to extract information from a web page, consider
the task of extracting the spring baseball schedule for the Cal Bears
from <a href="http://calbears.cstv.com/sports/m-basebl/sched/cal-m-basebl-sched.html">http://calbears.cstv.com/sports/m-basebl/sched/cal-m-basebl-sched.html</a> .

<div class="p"><!----></div>
 <h2><a name="tth_sEc1">
1</a>&nbsp;&nbsp;Reading a web page into R</h2>
Read the contents of the page into a vector of character strings with the
<tt>readLines</tt> function:

<pre>
&#62;&nbsp;thepage&nbsp;=&nbsp;readLines('http://calbears.cstv.com/sports/m-basebl/sched/cal-m-basebl-sched.html')
Warning&nbsp;message:
In&nbsp;readLines("http://calbears.cstv.com/sports/m-basebl/sched/cal-m-basebl-sched.html")&nbsp;:
&nbsp;&nbsp;incomplete&nbsp;final&nbsp;line&nbsp;found&nbsp;on&nbsp;'http://calbears.cstv.com/sports/m-basebl/sched/cal-m-basebl-sched.html'

</pre>
 The warning messages simply means that the last line of the web page didn't contain 
a newline character.  This is actually a good thing, since it usually indicates that the page
was generated by a program, which generally makes it easier to extract information from it.

<div class="p"><!----></div>
<em>Note: &nbsp;</em>When you're reading a web page, make a local copy for testing;
as a courtesy to the owner of the web site whose pages you're using, don't 
overload their server by constantly rereading the page.  
To make a copy from inside of R, look at the <tt>download.file</tt> function.
You could also save
a copy of the result of using <tt>readLines</tt>, and practice on that until
you've got everything working correctly.

<div class="p"><!----></div>
Now we have to focus in on what we're trying to extract.  The first step
is finding where it is.  If you look at the web page, you'll see that the
title "Opponent / Event" is right above the data we want.  We can locate this line
using the <tt>grep</tt> function:

<pre>
&#62;&nbsp;grep('Opponent&nbsp;/&nbsp;Event',thepage)
[1]&nbsp;513

</pre>

<div class="p"><!----></div>
If we look at the lines following this marker, we'll notice that the first
date on the schedule can be found in line 536, with the other information
following after:

<pre>
&#62;&nbsp;thepage[536:545]
&nbsp;[1]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;class=\"row-text\"&#62;02/20/11&lt;/td&#62;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[2]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[3]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;class=\"row-text\"&#62;vs.&nbsp;Utah&lt;/td&#62;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[4]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[5]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;class=\"row-text\"&#62;Berkeley,&nbsp;Calif.&lt;/td&#62;"
&nbsp;[6]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[7]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;class=\"row-text\"&#62;W,&nbsp;7-0&lt;/td&#62;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[8]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[9]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&#62;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
[10]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

</pre>
Based on the previous step, the data that we want is always preceded by
the HTML tag "<tt>&lt;td class="row-text&#187;</tt>", and followed by 
"<tt>&lt;/td&#62;</tt>".  Let's grab all the lines that have that pattern:

<pre>
&#62;&nbsp;mypattern&nbsp;=&nbsp;'&lt;td&nbsp;class="row-text"&#62;([^&lt;]*)&lt;/td&#62;'
&#62;&nbsp;datalines&nbsp;=&nbsp;grep(mypattern,thepage[536:length(thepage)],value=TRUE)

</pre>
 I used <tt>value=TRUE</tt>, so I wouldn't have to worry about the 
indexing when I restricted myself to the lines from 550 on.  Also notice that
I've already tagged the part that I want, in preparation to the final call to
<tt>gsub</tt>.

<div class="p"><!----></div>
Now that I've got the lines where my data is, I can use <tt>gregexpr</tt>,
then <tt>getexpr</tt> (from the previous lecture), and <tt>gsub</tt> to 
extract the information without the HTML tags:

<pre>
&#62;&nbsp;getexpr&nbsp;=&nbsp;function(s,g)substring(s,g,g+attr(g,'match.length')-1)
&#62;&nbsp;gg&nbsp;=&nbsp;gregexpr(mypattern,datalines)
&#62;&nbsp;matches&nbsp;=&nbsp;mapply(getexpr,datalines,gg)
&#62;&nbsp;result&nbsp;=&nbsp;gsub(mypattern,'\\1',matches)
&#62;&nbsp;names(result)&nbsp;=&nbsp;NULL
&#62;&nbsp;result[1:10]
&nbsp;[1]&nbsp;"02/19/11"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"vs.&nbsp;Utah"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Evans&nbsp;Diamond"&nbsp;"1:00&nbsp;p.m.&nbsp;PT"&nbsp;
&nbsp;[5]&nbsp;"02/20/11"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"vs.&nbsp;Utah"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Evans&nbsp;Diamond"&nbsp;"1:00&nbsp;p.m.&nbsp;PT"&nbsp;
&nbsp;[9]&nbsp;"02/22/11"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"at&nbsp;Stanford"&nbsp;&nbsp;

</pre>
It seems pretty clear that we've extracted just what we wanted - to make
it more usable, we'll convert it to a data frame and provide some titles.
Since it's hard to describe how to convert a vector to a data frame, we'll
use a matrix as an intermediate step.  Since there are four pieces of 
information (columns) for each game (row), a matrix is a natural choice:

<pre>
&#62;&nbsp;schedule&nbsp;=&nbsp;as.data.frame(matrix(result,ncol=4,byrow=TRUE))&nbsp;
&#62;&nbsp;names(schedule)&nbsp;=&nbsp;c('Date','Opponent','Location','Result')&nbsp;
&#62;&nbsp;head(schedule)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opponent&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Location&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Result
1&nbsp;02/19/11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vs.&nbsp;Utah&nbsp;&nbsp;&nbsp;&nbsp;Evans&nbsp;Diamond&nbsp;&nbsp;1:00&nbsp;p.m.&nbsp;PT
2&nbsp;02/20/11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vs.&nbsp;Utah&nbsp;&nbsp;&nbsp;&nbsp;Evans&nbsp;Diamond&nbsp;&nbsp;1:00&nbsp;p.m.&nbsp;PT
3&nbsp;02/22/11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Stanford&nbsp;Stanford,&nbsp;Calif.&nbsp;&nbsp;5:30&nbsp;p.m.&nbsp;PT
4&nbsp;02/25/11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Coastal&nbsp;Carolina&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Conway,&nbsp;S.C.&nbsp;&nbsp;4:00&nbsp;p.m.&nbsp;ET
5&nbsp;02/26/11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vs.&nbsp;Kansas&nbsp;State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Conway,&nbsp;S.C.&nbsp;11:00&nbsp;a.m.&nbsp;ET
6&nbsp;&nbsp;&nbsp;&amp;nbsp;&nbsp;vs.&nbsp;North&nbsp;Carolina&nbsp;State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Conway,&nbsp;S.C.&nbsp;11:30&nbsp;a.m.&nbsp;ET

</pre>

<div class="p"><!----></div>
 <h2><a name="tth_sEc2">
2</a>&nbsp;&nbsp;Another Example</h2>
At <a href="http://www.imdb.com/chart">http://www.imdb.com/chart</a> is a 
box-office summary of the ten top movies, along with their gross profits
for the current weekend, and their total gross profits.  We would like
to make a data frame with that information.  As always, the first part of
the solution is to read the page into R, and use an anchor to find the 
part of the data that we want.  In this case, the table has column
headings, including one for "Rank".

<pre>
&#62;&nbsp;x&nbsp;=&nbsp;readLines('http://www.imdb.com/chart/')
&#62;&nbsp;grep('Rank',x)
[1]&nbsp;1294&nbsp;1546&nbsp;1804

</pre>
 Starting with line 1294 we can look at the data to see where 
the information is.  A little experimentation shows that the useful
data starts on line 1310:

<pre>
&#62;&nbsp;x[1310:1318]
&nbsp;[1]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;class=\"chart_even_row\"&#62;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[2]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=\"/title/tt0990407/\"&#62;The&nbsp;Green&nbsp;Hornet&lt;/a&#62;&nbsp;(2011)"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[3]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&#62;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[4]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;class=\"chart_even_row\"&nbsp;style=\"text-align:&nbsp;right;&nbsp;padding-right:&nbsp;20px\"&#62;"
&nbsp;[5]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$33.5M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[6]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&#62;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[7]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;class=\"chart_even_row\"&nbsp;style=\"text-align:&nbsp;right\"&#62;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[8]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$40M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[9]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&#62;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
[10]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&#62;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

</pre>
There are two types of lines that contain useful data: the ones with the title, and 
the ones that begin with some blanks followed by a dollar sign.  Here's a regular
expression that will pull out both those lines:

<pre>
&#62;&nbsp;goodlines&nbsp;=&nbsp;'&lt;a&nbsp;href="/title[^&#62;]*&#62;(.*)&lt;/a&#62;.*$|^&nbsp;*\\$'
&#62;&nbsp;try&nbsp;=&nbsp;grep(goodlines,x,value=TRUE)

</pre>
Looking at the beginning of <tt>try</tt>, it seems like we got what we want:

<pre>
&#62;&nbsp;try[1:10]
&nbsp;[1]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=\"/title/tt1564367/\"&#62;Just&nbsp;Go&nbsp;with&nbsp;It&lt;/a&#62;&nbsp;(2011)"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[2]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$30.5M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[3]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$30.5M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[4]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=\"/title/tt1702443/\"&#62;Justin&nbsp;Bieber:&nbsp;Never&nbsp;Say&nbsp;Never&lt;/a&#62;&nbsp;(2011)"
&nbsp;[5]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$29.5M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[6]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$30.3M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[7]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=\"/title/tt0377981/\"&#62;Gnomeo&nbsp;&amp;#x26;&nbsp;Juliet&lt;/a&#62;&nbsp;(2011)"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[8]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$25.4M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;[9]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$25.4M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
[10]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=\"/title/tt1034389/\"&#62;The&nbsp;Eagle&lt;/a&#62;&nbsp;(2011)"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

</pre>
 Sometimes the trickiest part of getting the data off a webpage is figuring
out exactly the part you need.  In this case, there is a lot of extraneous information
after the table we want.  By examining the output, we can see that we only want the 
first 30 entries.  We also need to remove the extra information from the title 
line.  We can use the <tt>sub</tt> function with a modified version of our regular 
expression:

<pre>
&#62;&nbsp;try&nbsp;=&nbsp;try[1:30]
&#62;&nbsp;try&nbsp;=&nbsp;sub('&lt;a&nbsp;href="/title[^&#62;]*&#62;(.*)&lt;/a&#62;.*$','\\1',try)
&#62;&nbsp;head(try)
[1]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;Go&nbsp;with&nbsp;It"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
[2]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$30.5M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
[3]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$30.5M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
[4]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Justin&nbsp;Bieber:&nbsp;Never&nbsp;Say&nbsp;Never"
[5]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$29.5M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
[6]&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$30.3M"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

</pre>
 Once the spaces at the beginning of each line are 
removed, we can rearrange the data into a 3-column data frame:

<pre>
&#62;&nbsp;try&nbsp;=&nbsp;sub('^&nbsp;*','',try)
&#62;&nbsp;movies&nbsp;=&nbsp;data.frame(matrix(try,ncol=3,byrow=TRUE))
&#62;&nbsp;names(movies)&nbsp;=&nbsp;c('Name','Wkend&nbsp;Gross','Total&nbsp;Gross')
&#62;&nbsp;head(movies)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;Wkend&nbsp;Gross&nbsp;Total&nbsp;Gross
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;Go&nbsp;with&nbsp;It&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$30.5M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$30.5M
2&nbsp;Justin&nbsp;Bieber:&nbsp;Never&nbsp;Say&nbsp;Never&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$29.5M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$30.3M
3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gnomeo&nbsp;&amp;#x26;&nbsp;Juliet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$25.4M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$25.4M
4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;Eagle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$8.68M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$8.68M
5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;Roommate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$8.13M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$25.8M
6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;King&amp;#x27;s&nbsp;Speech&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$7.23M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$93.7M

</pre>
We can replace the special characters with the following code:

<pre>
&#62;&nbsp;movies$Name&nbsp;=&nbsp;sub('&amp;#x26;','&amp;',movies$Name)
&#62;&nbsp;movies$Name&nbsp;=&nbsp;sub('&amp;#x27;','\'',movies$Name)

</pre>

<div class="p"><!----></div>
 <h2><a name="tth_sEc3">
3</a>&nbsp;&nbsp;Dynamic Web Pages</h2>
While reading data from static web pages as in the previous examples can be
very useful (especially if you're extracting data from many pages), the 
real power of techniques like this has to do with dynamic pages, which accept
queries from users and return results based on those queries.  For example,
an enormous amount of information about genes and proteins can be found at 
the National Center of Biotechnology Information website 
(<a href="http://www.ncbi.nlm.nih.gov/">http://www.ncbi.nlm.nih.gov/</a>), much
of it available through query forms.  If you're only performing a few queries,
it's no  problem using the web page, but for many queries, it's beneficial
to automate the process.

<div class="p"><!----></div>
Here is a simple example that illustrate the concept of accessing dynamic
information from web pages.  The page
<a href="http://finance.yahoo.com">http://finance.yahoo.com</a> provides information about
stocks; if you enter a stock symbol on the page, (for example
<tt>aapl</tt> for Apple Computer), you will be directed to a page whose 
URL (as it appears in the browser address bar) is 

<pre>
http://finance.yahoo.com/q?s=aapl&amp;x=0&amp;y=0

</pre>
 The way that stock symbols are mapped to this URL is pretty
obvious.  We'll write an R function that will extract the current price
of whatever stock we're interested in.

<div class="p"><!----></div>
The first step in working with a page like this is to download
a local copy to play with, and to read the page into a vector of character
strings:

<pre>
&#62;&nbsp;download.file('http://finance.yahoo.com/q?s=aapl&amp;x=0&amp;y=0','quote.html')
trying&nbsp;URL&nbsp;'http://finance.yahoo.com/q?s=aapl&amp;x=0&amp;y=0'
Content&nbsp;type&nbsp;'text/html;&nbsp;charset=utf-8'&nbsp;length&nbsp;unknown
opened&nbsp;URL
..........&nbsp;..........&nbsp;..........&nbsp;.........
downloaded&nbsp;39Kb
&#62;&nbsp;x&nbsp;=&nbsp;readLines('quote.html')

</pre>
To get a feel for what we're looking for, notice that the words "Last Trade:"
appear before the current quote.  Let's look at the line containing 
this string:

<pre>
&#62;&nbsp;grep('Last&nbsp;Trade:',x)
45
&#62;&nbsp;nchar(x[45])
[1]&nbsp;3587

</pre>
 Since there are over 3500 characters in the line, we don't want 
to view it directly.  Let's use <tt>gregexpr</tt> to narrow down the search:

<pre>
&#62;&nbsp;gregexpr('Last&nbsp;Trade:',x[45])
[[1]]
[1]&nbsp;3125
attr(,"match.length")
[1]&nbsp;11

</pre>
 This shows that the string "Last Trade:" starts at character 3125.
We can use <tt>substr</tt> to see the relevant part of the line:

<pre>
&#62;&nbsp;substring(x[45],3125,3220)
[1]&nbsp;"Last&nbsp;Trade:&lt;/th&#62;&lt;td&nbsp;class=\"yfnc_tabledata1\"&#62;&lt;big&#62;&lt;b&#62;&lt;span&nbsp;id=\"yfs_l10_aapl\"&#62;363.50&lt;/span&#62;&lt;/b&#62;&lt;/b"

</pre>
There's plenty of context - we want the part surrounded by <tt>&lt;big&#62;&lt;b&#62;&lt;span ...</tt>
and <tt>&lt;/span&#62;</tt>.  One easy way to grab that part is to use a tagged
regular expression with <tt>gsub</tt>:

<pre>
&#62;&nbsp;gsub('^.*&lt;big&#62;&lt;b&#62;&lt;span&nbsp;[^&#62;]*&#62;([^&lt;]*)&lt;/span&#62;.*$','\\1',x[45])
[1]&nbsp;"363.50"

</pre>

<div class="p"><!----></div>
 This suggests the following function:

<pre>
&#62;&nbsp;getquote&nbsp;=&nbsp;function(sym){
+&nbsp;&nbsp;&nbsp;&nbsp;baseurl&nbsp;=&nbsp;'http://finance.yahoo.com/q?s='
+&nbsp;&nbsp;&nbsp;&nbsp;myurl&nbsp;=&nbsp;paste(baseurl,sym,'&amp;x=0&amp;y=0',sep='')
+&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;readLines(myurl)
+&nbsp;&nbsp;&nbsp;&nbsp;q&nbsp;=&nbsp;gsub('^.*&lt;big&#62;&lt;b&#62;&lt;span&nbsp;[^&#62;]*&#62;([^&lt;]*)&lt;/span&#62;.*$','\\1',grep('Last&nbsp;Trade:',x,value=TRUE))
+&nbsp;&nbsp;&nbsp;&nbsp;as.numeric(q)
+}&nbsp;

</pre>
 As always, functions like this should be tested:

<pre>
&#62;&nbsp;getquote('aapl')
[1]&nbsp;196.19
&#62;&nbsp;getquote('ibm')
[1]&nbsp;123.21
&#62;&nbsp;getquote('nok')
[1]&nbsp;13.35

</pre>

<div class="p"><!----></div>
These functions provide only a single quote;  a little exploration of the 
yahoo finance website shows that we can get CSV files with historical
data by using a URL of the form:

<div class="p"><!----></div>

<pre>
http://ichart.finance.yahoo.com/table.csv?s=xxx

</pre>
 where <tt>xxx</tt> is the symbol of interest.  
Since it's a comma-separated file, We can use <tt>read.csv</tt> to read the chart.

<pre>
gethistory&nbsp;=&nbsp;function(symbol)
&nbsp;&nbsp;&nbsp;read.csv(paste('http://ichart.finance.yahoo.com/table.csv?s=',symbol,sep=''))

</pre>
 Here's a simple test:

<pre>
&#62;&nbsp;aapl&nbsp;=&nbsp;gethistory('aapl')
&#62;&nbsp;head(aapl)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Date&nbsp;&nbsp;&nbsp;Open&nbsp;&nbsp;&nbsp;High&nbsp;&nbsp;&nbsp;&nbsp;Low&nbsp;&nbsp;Close&nbsp;&nbsp;&nbsp;Volume&nbsp;Adj.Close
1&nbsp;2011-02-15&nbsp;359.19&nbsp;359.97&nbsp;357.55&nbsp;359.90&nbsp;10126300&nbsp;&nbsp;&nbsp;&nbsp;359.90
2&nbsp;2011-02-14&nbsp;356.79&nbsp;359.48&nbsp;356.71&nbsp;359.18&nbsp;11073100&nbsp;&nbsp;&nbsp;&nbsp;359.18
3&nbsp;2011-02-11&nbsp;354.75&nbsp;357.80&nbsp;353.54&nbsp;356.85&nbsp;13114400&nbsp;&nbsp;&nbsp;&nbsp;356.85
4&nbsp;2011-02-10&nbsp;357.39&nbsp;360.00&nbsp;348.00&nbsp;354.54&nbsp;33126100&nbsp;&nbsp;&nbsp;&nbsp;354.54
5&nbsp;2011-02-09&nbsp;355.19&nbsp;359.00&nbsp;354.87&nbsp;358.16&nbsp;17222400&nbsp;&nbsp;&nbsp;&nbsp;358.16
6&nbsp;2011-02-08&nbsp;353.68&nbsp;355.52&nbsp;352.15&nbsp;355.20&nbsp;13579500&nbsp;&nbsp;&nbsp;&nbsp;355.20

</pre>
 Unfortunately, if we try to use the <tt>Date</tt>
column in plots, it will not work properly, since R has
stored it as a factor.  The format of the date is the default
for the <tt>as.Date</tt> function, so we can modify our 
function as follows:

<pre>
gethistory&nbsp;=&nbsp;function(symbol){
&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;read.csv(paste('http://ichart.finance.yahoo.com/table.csv?s=',symbol,sep=''))
&nbsp;&nbsp;&nbsp;data$Date&nbsp;=&nbsp;as.Date(data$Date)
&nbsp;&nbsp;&nbsp;data
}

</pre>
Now, we can produce plots with no problems:

<pre>
&#62;&nbsp;aapl&nbsp;=&nbsp;gethistory('aapl')
&#62;&nbsp;plot(aapl$Date,aapl$Close,main='Closing&nbsp;price&nbsp;for&nbsp;AAPL',type='l')

</pre>

<div class="p"><!----></div>
The plot is shown below:

<div class="p"><!----></div>
<img src="aapl.png">

<div class="p"><!----></div>

<br /><br /><hr /><small>File translated from
T<sub><font size="-1">E</font></sub>X
by <a href="http://hutchinson.belmont.ma.us/tth/">
T<sub><font size="-1">T</font></sub>H</a>,
version 3.67.<br />On 23 Feb 2011, 08:59.</small>
</html>
