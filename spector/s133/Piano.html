<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<meta name="GENERATOR" content="TtH 3.67">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>


<title> Piano</title>
 
<h1 align="center">Piano </h1>



 <h2><a name="tth_sEc1">
1</a>&nbsp;&nbsp;Getting the Frequencies for the Notes</h2>
After an internet search, I found the webpage
<a href="http://www.phy.mtu.edu/~suits/notefreqs.html">http://www.phy.mtu.edu/&nbsp;suits/notefreqs.html</a> which has a table of notes and their frequencies.
I scraped the data from the html with the following program:

<pre>
x&nbsp;=&nbsp;readLines('http://www.phy.mtu.edu/~suits/notefreqs.html')

mylines&nbsp;=&nbsp;grep('&lt;TD&nbsp;ALIGN=CENTER&#62;',x,value=TRUE)
mylines&nbsp;=&nbsp;matrix(mylines,ncol=3,byrow=TRUE)[,-3]
mylines&nbsp;=&nbsp;apply(mylines,2,function(x)sub('&lt;TD&nbsp;ALIGN=CENTER&#62;(.*)&lt;/TD&#62;','\\1',x))
mylines[,1]&nbsp;=&nbsp;sub('^([^0-9]+[0-9]).*$','\\1',mylines[,1])

notes&nbsp;=&nbsp;data.frame(gsub('&lt;/?su[pb]&#62;','',mylines[,1]),as.numeric(mylines[,2]))
names(notes)&nbsp;=&nbsp;c('notes','freq')

library(sound)

thenotes&nbsp;=&nbsp;lapply(notes$freq,function(x)cutSampleEnds(Sawtooth(x,.3)))
names(thenotes)&nbsp;=&nbsp;notes$notes
save(thenotes,file='thenotes.rda')

</pre>
 It takes a bit of computation to set up all the notes properly,
so I saved the list of notes that I created with the <tt>save</tt> command.
This produces a binary representation of the data which R can load very
quickly.  So instead of reading and calculating the frequencies every
time, I can quickly read them in when I need them.

<div class="p"><!----></div>
 <h2><a name="tth_sEc2">
2</a>&nbsp;&nbsp;The Piano</h2>
The first step is reading back the sounds stored in the last section
using the <tt>load</tt> command.  I wrote a little wrapper around the 
<tt>play</tt> command, because I needed to specify a program that was
capable of playing back the <tt>.wav</tt> files generated by the <tt>play</tt>
function that comes with the <tt>sound</tt> package.  If you're going to 
run this on your own computer, you can try to call <tt>play</tt> without the
<tt>command=</tt> argument, but you may have to find a command line program
to play back the wave files.

<div class="p"><!----></div>
Here's the program:

<pre>

require(tcltk)
require(sound)

load('thenotes.rda')&nbsp;&nbsp;#&nbsp;saved&nbsp;by&nbsp;the&nbsp;getfreq.r&nbsp;script

pnotes&nbsp;=&nbsp;c('C4','D4','E4','F4','G4','A4','B4','C5')

myplay&nbsp;=&nbsp;function(x)play(x,command='mplayer')

mfun&nbsp;=&nbsp;function(i){
&nbsp;&nbsp;&nbsp;ii&nbsp;=&nbsp;i
&nbsp;&nbsp;&nbsp;function(...)myplay(thenotes[[pnotes[ii]]])
}

main&nbsp;=&nbsp;tktoplevel()

black&nbsp;=&nbsp;tkframe(main)

tkpack(tklabel(black,width=2,height=4),side='left')
tkpack(tkbutton(black,width=2,height=4,bg='black',activebackground='black',command=function(...)myplay(thenotes[['C#4']])),side='left')
tkpack(tklabel(black,width=2,height=4),side='left')
tkpack(tkbutton(black,width=2,height=4,bg='black',activebackground='black',command=function(...)myplay(thenotes[['D#4']])),side='left')
tkpack(tklabel(black,width=7,height=4),side='left')
tkpack(tkbutton(black,width=2,height=4,bg='black',activebackground='black',command=function(...)myplay(thenotes[['F#4']])),side='left')
tkpack(tklabel(black,width=2,height=4),side='left')
tkpack(tkbutton(black,width=2,height=4,bg='black',activebackground='black',command=function(...)myplay(thenotes[['G#4']])),side='left')
tkpack(tklabel(black,width=2,height=4),side='left')
tkpack(tkbutton(black,width=2,height=4,bg='black',activebackground='black',command=function(...)myplay(thenotes[['A#4']])),side='left')
tkpack(tklabel(black,width=6,height=4),side='left')

tkpack(black)

white&nbsp;=&nbsp;tkframe(main)

for(i&nbsp;in&nbsp;1:8)tkpack(tkbutton(white,width=4,height=8,command=mfun(i)),side='left')

tkpack(white)

</pre>

<div class="p"><!----></div>
I created the piano with two main frames, <tt>black</tt> and <tt>white</tt>,
to hold the black keys and the white keys, respectively.  To get (approximately)
correct spacing of the black keys, I inserted empty labels between the 
buttons that represent the black keys.  Each button has a command associated
with it to play the note of the appropriate frequency.

<div class="p"><!----></div>
Here's how the piano looks:

<div class="p"><!----></div>
<img src="piano.png">


<br /><br /><hr /><small>File translated from
T<sub><font size="-1">E</font></sub>X
by <a href="http://hutchinson.belmont.ma.us/tth/">
T<sub><font size="-1">T</font></sub>H</a>,
version 3.67.<br />On 13 Apr 2009, 15:42.</small>
</html>
